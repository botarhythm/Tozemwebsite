# REFACTOR_QUEUE.md (Handoff to Claude Code)

## Status: IN_PROGRESS (Handoff from Antigravity)

### 【緊急】WordPressテーマ更新失敗の調査と復旧

#### 1. 現状の不具合内容
WordPress管理画面からテーマ（`tozem-theme.zip`）を更新しようとすると、以下のエラーが発生して更新に失敗します。
> 「旧バージョンのテーマを削除できませんでした。テーマの更新に失敗しました。」

#### 2. 背景と経緯
- **v4.5.10**: NotebookLMで生成した28MBのPDFマニュアルを `assets/` に含めてZIP化。アップロードは成功したが、PDFが破損（開けない）。原因はPHP/Xserver側での解凍処理タイムアウトと推測。
- **v4.5.11**: ZIP圧縮コマンドを `Compress-Archive` に変更。しかし、解凍時に `inc/` などのディレクトリ構造が破壊され、サイト全体が Fatal Error（500エラー）に。
- **v4.5.12**: 圧縮コマンドを `tar` に戻して修正。しかし、前回の失敗した解凍プロセスの残骸やロックにより、WordPressが「旧バージョンの削除」に失敗し、更新がブロックされている状態。

#### 3. 依頼タスク
1. **更新ブロックの解消**:
   - Xserver上のファイル構成（`wp-content/themes/` 内）を調査し、なぜ削除に失敗しているか特定してください。
   - 競合しているディレクトリ（`tozem-theme` や `tozem-theme-2` など）のリネームやクリーンアップが必要な場合、ユーザーにXserverファイルマネージャ経由での操作を具体的に指示してください。
2. **大容量アセット（PDF）の扱い**:
   - 28MBのPDFを含めた状態での安定したデプロイ方法を再検討してください。
   - 必要であれば、PDFのみを別ルート（FTP等）でアップロードするよう指示し、テーマの軽量化を提案してください。
3. **サイトの安定化確認**:
   - テーマが正しく適用され、ダッシュボードおよびフロントエンドが正常に動作することを確認してください。

#### 4. Claude Code へのメッセージ
現在、ユーザーの画面上でテーマ更新が止まってしまっています。Xserver特有 of ファイルロックや、WordPressのアップロード失敗時のリカバリ手順に詳しいあなたの知見を活かして、サイトを正常な状態に戻してください。
現在の `wordpress-theme` フォルダ内のコードは v4.5.12 で、正常な状態に修正済みです。問題は「サーバーへの反映」プロセスにあります。

---
Created by Antigravity at 2026-02-26 23:50 JST
